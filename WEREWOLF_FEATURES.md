# 狼人杀游戏功能说明

## 功能概述

次元阅关的狼人杀游戏系统已全面升级，新增了以下核心功能：

### 1. 多局数支持

#### 6人局
- **狼人**: 2人
- **村民**: 2人
- **预言家**: 1人
- **女巫**: 1人

#### 9人局
- **狼人**: 3人
- **村民**: 3人
- **预言家**: 1人
- **女巫**: 1人
- **猎人**: 1人

#### 12人局
- **狼人**: 4人
- **村民**: 4人
- **预言家**: 1人
- **女巫**: 1人
- **猎人**: 1人
- **守卫**: 1人

### 2. AI人设系统

#### 预设人设（6种）

1. **逻辑大师**
   - 逻辑性: 95%
   - 情绪化: 20%
   - 激进度: 50%
   - 谨慎度: 80%
   - 信任度: 40%
   - 特点: 擅长逻辑推理，发言条理清晰，善于分析局势

2. **情感玩家**
   - 逻辑性: 50%
   - 情绪化: 90%
   - 激进度: 30%
   - 谨慎度: 50%
   - 信任度: 70%
   - 特点: 情绪表达丰富，善于观察他人情绪，直觉敏锐

3. **激进派**
   - 逻辑性: 60%
   - 情绪化: 70%
   - 激进度: 95%
   - 谨慎度: 20%
   - 信任度: 30%
   - 特点: 发言激进，主动带节奏，敢于质疑他人

4. **谨慎派**
   - 逻辑性: 70%
   - 情绪化: 40%
   - 激进度: 20%
   - 谨慎度: 95%
   - 信任度: 50%
   - 特点: 发言谨慎，不轻易表态，善于观察和等待

5. **新手友好**
   - 逻辑性: 50%
   - 情绪化: 50%
   - 激进度: 40%
   - 谨慎度: 60%
   - 信任度: 60%
   - 特点: 适合新手，发言简单明了，策略稳健

6. **老狐狸**
   - 逻辑性: 85%
   - 情绪化: 60%
   - 激进度: 60%
   - 谨慎度: 85%
   - 信任度: 30%
   - 特点: 经验丰富，善于伪装和误导，发言滴水不漏

#### 自定义人设

用户可以创建自己的AI人设，自定义以下参数：
- **人设名称**: 自定义名称
- **人设描述**: 描述人设特点
- **逻辑性**: 0-100%，控制AI的逻辑推理能力
- **情绪化**: 0-100%，控制AI的情绪表达程度
- **激进度**: 0-100%，控制AI的主动性和攻击性
- **谨慎度**: 0-100%，控制AI的保守程度
- **信任度**: 0-100%，控制AI对他人的信任倾向

### 3. 发言记录系统

#### 自动记录
- 游戏过程中自动记录所有玩家的发言
- 记录内容包括：
  - 发言者
  - 发言内容
  - 发言时的游戏阶段（夜晚/白天/投票）
  - 发言回合数
  - 发言时间

#### 数据存储
- 所有发言记录保存到数据库
- 支持后续查询和分析
- 可用于生成游戏复盘

### 4. AI人设学习系统

#### 学习流程

1. **游戏中记录**
   - 在游戏过程中，系统自动记录用户的所有发言
   - 记录发言的上下文信息（游戏阶段、回合数等）

2. **游戏结束分析**
   - 游戏结束后，用户可以选择"生成人设"
   - 系统使用AI分析用户的发言记录
   - 至少需要5条发言才能生成人设

3. **AI分析维度**
   - **逻辑性分析**: 发言是否有条理，推理是否严密
   - **情绪化分析**: 情绪表达是否丰富
   - **激进度分析**: 是否主动质疑和带节奏
   - **谨慎度分析**: 是否谨慎保守
   - **信任度分析**: 是否容易相信他人
   - **关键短语提取**: 提取用户常用的表达方式
   - **决策模式分析**: 分析用户的决策习惯

4. **生成新人设**
   - AI根据分析结果自动生成人设名称和描述
   - 设置各项性格参数
   - 保存示例发言用于后续AI学习
   - 生成的人设可在下次游戏中使用

#### 学习记录
- 每次生成人设都会创建学习记录
- 记录包括：
  - 来源游戏会话
  - 分析的发言数量
  - AI分析结果
  - 置信度分数
  - 生成的人设ID

### 5. 游戏流程

#### 游戏准备
1. 选择局数（6人/9人/12人）
2. 查看角色配置
3. 选择AI人设（最多选择 局数-1 个）
4. 开始游戏

#### 游戏进行
1. **夜晚阶段**
   - 系统提示"天黑请闭眼"
   - 玩家可以发言讨论策略

2. **白天阶段**
   - 系统提示"天亮了"
   - 玩家轮流发言
   - AI根据人设特征做出回应

3. **投票阶段**
   - 系统提示"请开始投票"
   - 玩家进行投票

4. **回合循环**
   - 完成投票后进入下一回合
   - 重复夜晚-白天-投票流程

#### 游戏结束
1. 点击"结束游戏"按钮
2. 弹出人设学习对话框
3. 选择是否生成新人设
4. 查看游戏统计数据

### 6. 技术特性

#### 数据库表结构

1. **werewolf_personas** - 人设表
   - 存储所有人设数据
   - 支持预设、自定义、学习三种类型

2. **werewolf_speech_records** - 发言记录表
   - 记录所有游戏发言
   - 关联游戏会话

3. **werewolf_persona_learning** - 学习记录表
   - 记录人设生成过程
   - 存储AI分析结果

4. **werewolf_game_configs** - 游戏配置表
   - 存储不同局数的角色配置
   - 支持自定义规则

#### AI集成
- 使用DeepSeek-V3.1-Terminus模型
- 支持角色扮演和性格模拟
- 根据人设参数调整AI行为
- 智能分析用户发言习惯

#### 实时交互
- 即时发言和回复
- 流畅的游戏体验
- 自动滚动到最新消息
- AI思考状态提示

## 使用指南

### 开始游戏

1. 访问狼人杀页面
2. 选择想要的局数（6人/9人/12人）
3. 查看该局数的角色配置
4. 在"预设人设"或"自定义人设"标签中选择AI玩家
5. 点击"开始游戏"按钮

### 创建自定义人设

1. 点击"创建人设"按钮
2. 输入人设名称和描述
3. 调整五个性格参数滑块
4. 点击"创建人设"保存

### 游戏中操作

1. 在文本框中输入发言内容
2. 点击"发送"按钮或按Enter键发送
3. 等待AI玩家回应
4. 点击"进入下一阶段"切换游戏阶段
5. 点击"结束游戏"结束当前游戏

### 生成学习人设

1. 游戏结束后，弹出人设学习对话框
2. 查看本局游戏统计数据
3. 点击"生成人设"按钮
4. 等待AI分析完成
5. 新人设自动保存到"自定义人设"中

## 未来扩展

### 计划功能

1. **语音识别**
   - 支持语音输入发言
   - 语音合成AI回复

2. **更多人设**
   - 增加更多预设人设
   - 支持人设分享

3. **高级分析**
   - 游戏复盘功能
   - 发言热力图
   - 玩家关系网络

4. **社交功能**
   - 人设评分系统
   - 人设排行榜
   - 好友对战

5. **AI优化**
   - 更智能的策略决策
   - 更自然的对话
   - 学习真实玩家风格

## 技术支持

如有问题，请查看：
- 项目文档
- 代码注释
- 控制台错误信息

---

**版本**: 2.0.0  
**更新时间**: 2025-01-10  
**功能状态**: ✅ 已完成
