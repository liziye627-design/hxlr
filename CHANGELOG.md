# 更新日志

## [2.0.0] - 2025-01-10

### 🎮 狼人杀游戏系统全面升级

#### 新增功能

##### 1. 多局数支持
- ✅ 新增6人局配置（2狼2民1预1女）
- ✅ 新增9人局配置（3狼3民1预1女1猎）
- ✅ 新增12人局配置（4狼4民1预1女1猎1守）
- ✅ 动态显示角色配置信息
- ✅ 局数选择界面优化

##### 2. AI人设系统
- ✅ 6种预设人设
  - 逻辑大师：高逻辑、低情绪、中激进、高谨慎
  - 情感玩家：中逻辑、高情绪、低激进、中谨慎
  - 激进派：中逻辑、高情绪、高激进、低谨慎
  - 谨慎派：高逻辑、低情绪、低激进、高谨慎
  - 新手友好：平衡型人设
  - 老狐狸：高逻辑、中情绪、中激进、高谨慎
- ✅ 自定义人设创建
  - 自定义人设名称和描述
  - 5个性格参数滑块调节
  - 实时预览参数值
- ✅ 人设详细信息展示
  - 性格特征可视化
  - 使用次数统计
  - 评分系统

##### 3. 发言记录系统
- ✅ 自动记录所有发言
  - 记录发言者信息
  - 记录游戏阶段（夜晚/白天/投票）
  - 记录回合数
  - 记录时间戳
- ✅ 发言数据持久化
  - 保存到数据库
  - 支持后续查询
  - 用于AI分析

##### 4. AI人设学习系统
- ✅ 游戏发言分析
  - 分析逻辑性
  - 分析情绪化程度
  - 分析激进度
  - 分析谨慎度
  - 分析信任倾向
- ✅ 自动生成人设
  - AI智能分析发言习惯
  - 提取关键短语
  - 生成人设名称和描述
  - 设置性格参数
- ✅ 学习记录管理
  - 记录分析过程
  - 保存置信度分数
  - 关联生成的人设

##### 5. 游戏房间系统
- ✅ 实时游戏界面
  - 玩家列表显示
  - 发言记录滚动显示
  - 实时消息更新
- ✅ 游戏流程控制
  - 夜晚/白天/投票阶段切换
  - 回合数管理
  - 游戏状态跟踪
- ✅ AI智能对话
  - 根据人设特征生成回复
  - 考虑游戏上下文
  - 自然的对话体验

#### 数据库更新

##### 新增表
1. **werewolf_personas** - 狼人杀人设表
   - 支持预设、自定义、学习三种类型
   - 存储性格特征和行为模式
   - 记录使用统计

2. **werewolf_speech_records** - 发言记录表
   - 记录所有游戏发言
   - 关联游戏会话
   - 支持多维度查询

3. **werewolf_persona_learning** - 人设学习记录表
   - 记录学习过程
   - 存储AI分析结果
   - 跟踪生成状态

4. **werewolf_game_configs** - 游戏配置表
   - 存储不同局数配置
   - 支持自定义规则
   - 默认配置预置

##### 初始数据
- ✅ 插入6种预设人设
- ✅ 插入3种游戏配置（6/9/12人局）
- ✅ 创建必要索引

#### API更新

##### 新增API（werewolfApi）
- `getAllPersonas()` - 获取所有人设
- `getPublicPersonas()` - 获取公开人设
- `getUserPersonas()` - 获取用户自定义人设
- `createPersona()` - 创建人设
- `updatePersona()` - 更新人设
- `incrementPersonaUsage()` - 增加使用次数
- `getGameConfigs()` - 获取游戏配置
- `getConfigByPlayerCount()` - 获取指定局数配置
- `recordSpeech()` - 记录发言
- `getSessionSpeeches()` - 获取会话发言
- `createPersonaLearning()` - 创建学习任务
- `updatePersonaLearning()` - 更新学习任务
- `getUserLearningRecords()` - 获取学习记录

#### 类型定义更新

##### 新增类型
- `WerewolfPersona` - 人设类型
- `WerewolfSpeechRecord` - 发言记录类型
- `WerewolfPersonaLearning` - 学习记录类型
- `WerewolfGameConfig` - 游戏配置类型
- `WerewolfPlayer` - 玩家类型
- `WerewolfGameState` - 游戏状态类型

#### 页面更新

##### 新增页面
- `src/pages/Werewolf.tsx` - 狼人杀主页（重构）
  - 局数选择界面
  - 人设选择界面
  - 自定义人设创建
- `src/pages/werewolf/GameRoom.tsx` - 游戏房间页面
  - 实时游戏界面
  - 发言记录显示
  - AI对话系统
  - 人设学习功能

##### 路由更新
- 新增 `/werewolf/game` 路由

#### UI/UX改进
- ✅ 响应式设计优化
- ✅ 卡片式布局
- ✅ 流畅的动画效果
- ✅ 直观的人设参数展示
- ✅ 实时消息滚动
- ✅ 加载状态提示
- ✅ 错误提示优化

#### 技术优化
- ✅ TypeScript类型安全
- ✅ 代码模块化
- ✅ API封装完善
- ✅ 错误处理增强
- ✅ 性能优化

### 📝 文档更新
- ✅ 新增 `WEREWOLF_FEATURES.md` - 狼人杀功能详细说明
- ✅ 新增 `CHANGELOG.md` - 更新日志
- ✅ 更新 `PROJECT_SUMMARY.md` - 项目总结

### 🐛 Bug修复
- ✅ 修复类型定义错误
- ✅ 修复API调用问题
- ✅ 修复路由配置

### 🔧 技术栈
- React 18
- TypeScript
- Supabase
- DeepSeek AI (V3.1-Terminus)
- shadcn/ui
- Tailwind CSS

---

## [1.0.0] - 2025-01-10

### 初始版本

#### 核心功能
- ✅ 用户系统
- ✅ AI伴侣系统
- ✅ 游戏会话管理
- ✅ 战绩记录
- ✅ 排行榜系统
- ✅ VIP会员系统

#### 游戏模式
- ✅ AI狼人杀（基础版）
- ✅ AI剧本杀
- ✅ 数字冒险

#### 技术实现
- ✅ Supabase数据库集成
- ✅ DeepSeek AI集成
- ✅ 完整的UI组件库
- ✅ 响应式设计

---

**维护者**: 开发团队  
**最后更新**: 2025-01-10
